#version 330 core
out vec4 FragColor;
out vec4 FragNormal;
precision mediump float; 

in vec3 v_frag_coord;
in vec3 v_normal; 
in vec3 v_normal_2;

uniform vec3 u_view_pos; 
uniform mat4 M;

//What information do you need for the light ? (position, strength, ...)
uniform float u_ambient;
uniform float u_diffuse;
uniform float u_specular;
uniform float u_emissive; 
uniform vec3 u_light_pos;
uniform vec3 lightColour;
//What information do you need about the object ?
uniform vec3 materialColour; 
uniform float u_shininess;

void main() { 
//Compute each of the component needed (specular light, diffuse light, attenuation,...)
	vec3 L = normalize(u_light_pos - v_frag_coord);
	vec3 N = v_normal;
	vec3 R = (reflect(-L,N));
	vec3 V = normalize(u_view_pos - v_frag_coord);

	vec3 ambient = u_ambient*materialColour;
	float diff = max(dot(N,L), 0.0);
	vec3 diffuse = diff*lightColour;
	float spec = pow(max(dot(R,V),0.0),u_shininess);
	vec3 specular = u_specular*spec*lightColour;

	float attenuation = 1.0/(1.0+ 0.2*pow(length(u_light_pos - v_frag_coord),1)+0.0*pow(length(u_light_pos - v_frag_coord),2));

	//Compute the value for the light
	if (length(specular*attenuation*materialColour) < 0.1){
		FragColor = vec4(materialColour*(ambient + u_emissive + (diffuse + specular)*attenuation), 1.0); 
	}
	else{
		//FragColor = vec4(lightColour,1.0)*(attenuation) +vec4(materialColour,1.0)*(1-attenuation);
		FragColor = vec4(lightColour,1.0);
	}
	
	FragNormal = vec4((v_normal_2 + vec3(1.0))*0.5,1.0);
};